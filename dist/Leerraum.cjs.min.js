"use strict";function LinkedList(){this.head=null,this.tail=null,this.listSize=0}Object.defineProperty(exports,"__esModule",{value:!0}),LinkedList.Node=function(t){this.prev=null,this.next=null,this.data=t},LinkedList.Node.prototype.toString=function(){return this.data.toString()},LinkedList.prototype.isLinked=function(t){return!(t&&null===t.prev&&null===t.next&&this.tail!==t&&this.head!==t||this.isEmpty())},LinkedList.prototype.size=function(){return this.listSize},LinkedList.prototype.isEmpty=function(){return 0===this.listSize},LinkedList.prototype.first=function(){return this.head},LinkedList.prototype.last=function(){return this.last},LinkedList.prototype.toString=function(){return this.toArray().toString()},LinkedList.prototype.toArray=function(){for(var t=this.head,e=[];null!==t;)e.push(t),t=t.next;return e},LinkedList.prototype.forEach=function(t){for(var e=this.head;null!==e;)t(e),e=e.next},LinkedList.prototype.contains=function(t){var e=this.head;if(!this.isLinked(t))return!1;for(;null!==e;){if(e===t)return!0;e=e.next}return!1},LinkedList.prototype.at=function(t){var e=this.head,i=0;if(t>=this.listLength||t<0)return null;for(;null!==e;){if(t===i)return e;e=e.next,i+=1}return null},LinkedList.prototype.insertAfter=function(t,e){return this.isLinked(t)&&(e.prev=t,e.next=t.next,null===t.next?this.tail=e:t.next.prev=e,t.next=e,this.listSize+=1),this},LinkedList.prototype.insertBefore=function(t,e){return this.isLinked(t)&&(e.prev=t.prev,null===(e.next=t).prev?this.head=e:t.prev.next=e,t.prev=e,this.listSize+=1),this},LinkedList.prototype.push=function(t){return null===this.head?this.unshift(t):this.insertAfter(this.tail,t),this},LinkedList.prototype.unshift=function(t){return null===this.head?(this.head=t,(this.tail=t).prev=null,t.next=null,this.listSize+=1):this.insertBefore(this.head,t),this},LinkedList.prototype.remove=function(t){return this.isLinked(t)&&(null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this.listSize-=1),this},LinkedList.prototype.pop=function(){var t=this.tail;return this.tail.prev.next=null,this.tail=this.tail.prev,this.listSize-=1,t.prev=null,t.next=null,t},LinkedList.prototype.shift=function(){var t=this.head;return this.head.next.prev=null,this.head=this.head.next,this.listSize-=1,t.prev=null,t.next=null,t};var linebreak=function(m,t,e){var L={line:e&&e.demerits&&e.demerits.line||10,flagged:e&&e.demerits&&e.demerits.flagged||100,fitness:e&&e.demerits&&e.demerits.fitness||3e3},M=e&&e.tolerance||2,S=new LinkedList,A={width:0,stretch:0,shrink:0},C=t,i=[],n={data:{demerits:1/0}};function z(t,e,i,n,r,h,a){return{position:t,demerits:e,ratio:i,line:n,fitnessClass:r,totals:h||{width:0,stretch:0,shrink:0},previous:a}}function E(t){var e={width:A.width,stretch:A.stretch,shrink:A.shrink},i=0;for(i=t;i<m.length;i+=1)if("glue"===m[i].type)e.width+=m[i].width,e.stretch+=m[i].stretch,e.shrink+=m[i].shrink;else if("box"===m[i].type||"penalty"===m[i].type&&m[i].penalty===-linebreak.infinity&&t<i)break;return e}function r(t,e,i){for(var n,r,h,a,l,o,s,u,f,p,d,y,g=S.first(),c=null,v=0,x=0,w=[],k=0,b=0;null!==g;){for(w=[{demerits:1/0},{demerits:1/0},{demerits:1/0},{demerits:1/0}];null!==g;){if(c=g.next,k=g.data.line+1,g.data.position,o=e,s=g.data,u=k,d=p=f=void 0,f=A.width-s.totals.width,d=p=0,null===(v=null===(y=C(u-1))?null:("penalty"===m[o].type&&(f+=m[o].width),f<y?0<(p=A.stretch-s.totals.stretch)?(y-f)/p:linebreak.infinity:y<f?0<(d=A.shrink-s.totals.shrink)?(y-f)/d:linebreak.infinity:0))){g=null;break}if((v<-1||"penalty"===t.type&&t.penalty===-linebreak.infinity)&&S.remove(g),-1<=v&&v<=M&&(n=100*Math.pow(Math.abs(v),3),x="penalty"===t.type&&0<=t.penalty?Math.pow(L.line+n,2)+Math.pow(t.penalty,2):"penalty"===t.type&&t.penalty!==-linebreak.infinity?Math.pow(L.line+n,2)-Math.pow(t.penalty,2):Math.pow(L.line+n,2),"penalty"===t.type&&"penalty"===i[g.data.position].type&&(x+=L.flagged*t.flagged*i[g.data.position].flagged),b=v<-.5?0:v<=.5?1:v<=1?2:3,1<Math.abs(b-g.data.fitnessClass)&&(x+=L.fitness),(x+=g.data.demerits)<w[b].demerits&&(w[b]={active:g,demerits:x,ratio:v})),null!==(g=c)&&g.data.line>=k)break}for(r=E(e),h=0;h<w.length;h+=1)(a=w[h]).demerits<1/0&&(l=new LinkedList.Node(z(e,a.demerits,a.ratio,a.active.data.line+1,h,r,a.active)),null!==g?S.insertBefore(g,l):S.push(l))}}if(S.push(new LinkedList.Node(z(0,0,0,0,0,void 0,null))),m.forEach(function(t,e,i){"box"===t.type?A.width+=t.width:"glue"===t.type?(0<e&&"box"===i[e-1].type&&r(t,e,i),A.width+=t.width,A.stretch+=t.stretch,A.shrink+=t.shrink):"penalty"===t.type&&t.penalty!==linebreak.infinity&&r(t,e,i)}),0===S.size())return[];for(S.forEach(function(t){t.data.demerits<n.data.demerits&&(n=t)});null!==n;)i.push({position:n.data.position,ratio:n.data.ratio}),n=n.data.previous;return i.reverse()};function memoize(e){var i={};return function(t){return void 0!==i[t]||(i[t]=e(t)),i[t]}}function zip(t,i){return t.map(function(t,e){return[t,i[e]]})}function cons(e,i){return function(t){return 0==t?e:i(t-1)}}function skip(e,i){return function(t){return i(t+e)}}function map(i){return function(e){return function(t){return i(e(t))}}}function bboxesIntersect(t,e){return!(t.x+t.width<e.x||t.y+t.height<e.y||e.x+e.width<t.x||e.y+e.height<t.y)}function bboxEq(t,e){var i=.001;return t.x>=e.x-i&&t.x<=e.x+i&&t.y>=e.y-i&&t.y<=e.y+i&&t.width>=e.width-i&&t.width<=e.width+i&&t.height>=e.height-i&&t.height<=e.height+i}function mergeBBoxes(t,e){var i=Math.min(t.x,e.x),n=Math.min(t.y,e.y);return{x:i,y:n,width:Math.max(t.x+t.width,e.x+e.width)-i,height:Math.max(t.y+t.height,e.y+e.height)-n}}function bboxForPoints(t){for(var e=Number.MIN_VALUE,i=Number.MIN_VALUE,n=Number.MAX_VALUE,r=Number.MAX_VALUE,h=0,a=t;h<a.length;h++){var l=a[h];e=Math.max(e,l.x),n=Math.min(n,l.x),i=Math.max(i,l.y),r=Math.min(r,l.y)}return{x:n,y:n,width:e-n,height:i-r}}function justify(f,p,t,i){var d=[];return t.forEach(function(r,h,a){var t=r.text.split(/\s/),l=f(r.fontFamily,r.fontSize," "),e={width:i&&i.space.width||3,stretch:i&&i.space.stretch||6,shrink:i&&i.space.shrink||9},o=f(r.fontFamily,r.fontSize,"-"),s=l*e.width/e.stretch,u=l*e.width/e.shrink;t.forEach(function(t,e,i){var n=r.hyphenate?p.hyphenate(t):[t];1<n.length&&4<t.length?n.forEach(function(t,e,i){d.push({style:r,value:linebreak.box(f(r.fontFamily,r.fontSize,t),t)}),e!==i.length-1&&d.push({style:r,value:linebreak.penalty(o,100,1)})}):d.push({style:r,value:linebreak.box(f(r.fontFamily,r.fontSize,t),t)}),h===a.length-1&&e===i.length-1?(d.push({style:r,value:linebreak.glue(0,linebreak.infinity,0)}),d.push({style:r,value:linebreak.penalty(0,-linebreak.infinity,1)})):e!==i.length-1&&d.push({style:r,value:linebreak.glue(l,s,u)})})}),d}function left(s,u,t,e){var f=[];return t.forEach(function(r,h,a){var t=r.text.split(/\s/),l=s(r.fontFamily,r.fontSize," "),o=(e&&e.space.width,e&&e.space.stretch,e&&e.space.shrink,s(r.fontFamily,r.fontSize,"-"));t.forEach(function(t,e,i){var n=r.hyphenate?u.hyphenate(t):[t];1<n.length&&4<t.length?n.forEach(function(t,e,i){f.push({style:r,value:linebreak.box(s(r.fontFamily,r.fontSize,t),t)}),e!==i.length-1&&f.push({style:r,value:linebreak.penalty(o,100,1)})}):f.push({style:r,value:linebreak.box(s(r.fontFamily,r.fontSize,t),t)}),h===a.length-1&&e===i.length-1?(f.push({style:r,value:linebreak.glue(0,linebreak.infinity,0)}),f.push({style:r,value:linebreak.penalty(0,-linebreak.infinity,1)})):e!==i.length-1&&(f.push({style:r,value:linebreak.glue(0,12,0)}),f.push({style:r,value:linebreak.penalty(0,0,0)}),f.push({style:r,value:linebreak.glue(l,-12,0)}))})}),f}function center(s,u,t,e){var f=[];return 0<t.length&&(f.push({style:t[0],value:linebreak.box(0,"")}),f.push({style:t[0],value:linebreak.glue(0,12,0)})),t.forEach(function(r,h,a){var t=r.text.split(/\s/),l=s(r.fontFamily,r.fontSize," "),o=(e&&e.space.width,e&&e.space.stretch,e&&e.space.shrink,s(r.fontFamily,r.fontSize,"-"));t.forEach(function(t,e,i){var n=u.hyphenate(t);1<n.length&&4<t.length?n.forEach(function(t,e,i){f.push({style:r,value:linebreak.box(s(r.fontFamily,r.fontSize,t),t)}),e!==i.length-1&&f.push({style:r,value:linebreak.penalty(o,100,1)})}):f.push({style:r,value:linebreak.box(s(r.fontFamily,r.fontSize,t),t)}),h===a.length-1&&e===i.length-1?(f.push({style:r,value:linebreak.glue(0,12,0)}),f.push({style:r,value:linebreak.penalty(0,-linebreak.infinity,0)})):e!==i.length-1&&(f.push({style:r,value:linebreak.glue(0,12,0)}),f.push({style:r,value:linebreak.penalty(0,0,0)}),f.push({style:r,value:linebreak.glue(l,-24,0)}),f.push({style:r,value:linebreak.box(0,"")}),f.push({style:r,value:linebreak.penalty(0,linebreak.infinity,0)}),f.push({style:r,value:linebreak.glue(0,12,0)}))})}),f}linebreak.infinity=1e4,linebreak.glue=function(t,e,i){return{type:"glue",width:t,stretch:e,shrink:i}},linebreak.box=function(t,e){return{type:"box",width:t,value:e}},linebreak.penalty=function(t,e,i){return{type:"penalty",width:t,penalty:e,flagged:i}};var idRenderer=function(t,e){return[[],[]]};function landscape(t){return{width:t.height,height:t.width}}var formats={"4A0":{width:4767.87,height:6740.79},"2A0":{width:3370.39,height:4767.87},A0:{width:2383.94,height:3370.39},A1:{width:1683.78,height:2383.94},A2:{width:1190.55,height:1683.78},A3:{width:841.89,height:1190.55},A4:{width:595.28,height:841.89},A5:{width:419.53,height:595.28},A6:{width:297.64,height:419.53},A7:{width:209.76,height:297.64},A8:{width:147.4,height:209.76},A9:{width:104.88,height:147.4},A10:{width:73.7,height:104.88},B0:{width:2834.65,height:4008.19},B1:{width:2004.09,height:2834.65},B2:{width:1417.32,height:2004.09},B3:{width:1000.63,height:1417.32},B4:{width:708.66,height:1000.63},B5:{width:498.9,height:708.66},B6:{width:354.33,height:498.9},B7:{width:249.45,height:354.33},B8:{width:175.75,height:249.45},B9:{width:124.72,height:175.75},B10:{width:87.87,height:124.72},C0:{width:2599.37,height:3676.54},C1:{width:1836.85,height:2599.37},C2:{width:1298.27,height:1836.85},C3:{width:918.43,height:1298.27},C4:{width:649.13,height:918.43},C5:{width:459.21,height:649.13},C6:{width:323.15,height:459.21},C7:{width:229.61,height:323.15},C8:{width:161.57,height:229.61},C9:{width:113.39,height:161.57},C10:{width:79.37,height:113.39},RA0:{width:2437.8,height:3458.27},RA1:{width:1729.13,height:2437.8},RA2:{width:1218.9,height:1729.13},RA3:{width:864.57,height:1218.9},RA4:{width:609.45,height:864.57},SRA0:{width:2551.18,height:3628.35},SRA1:{width:1814.17,height:2551.18},SRA2:{width:1275.59,height:1814.17},SRA3:{width:907.09,height:1275.59},SRA4:{width:637.8,height:907.09},EXECUTIVE:{width:521.86,height:756},FOLIO:{width:612,height:936},LEGAL:{width:612,height:1008},LETTER:{width:612,height:792},TABLOID:{width:792,height:1224}};function combine(L){return function(t,e){for(var i=[],n=[],r=[],h=0,a=L;h<a.length;h++){var l=a[h],o=l[0],s=(0,l[1])(t,map(o)(e)),u=s[0],f=s[1];n=n.concat(u),r=r.concat(f)}for(var p={},d=0,y=n;d<y.length;d++)for(var g=y[d],c=0,v=void 0,x=!1;v=e(c);){if(bboxesIntersect(g,v))void 0===p[c]&&(p[c]=[]),p[c].push(g),x=!0;else if(x)break;c++}for(var w=0,k=Object.keys(p).sort();w<k.length;w++){var b=p[k[w]],m=b[0];for(c=1;c<b.length;c++)m=mergeBBoxes(m,b[c]);i.push(m)}return[i,r]}}function vertically(y){return function(t,e){for(var i=[],n=e,r=[],h=0,a=y;h<a.length;h++){var l=(0,a[h])(t,n),o=l[0],s=l[1];if(0<o.length){for(var u=null,f=o[o.length-1],p=0;null!==(u=n(p))&&!bboxesIntersect(u,f);)p++;if(null!=u){var d={x:u.x,y:f.y+f.height,width:u.width,height:u.y+u.height-(f.y+f.height)};n=0<d.height?cons(d,skip(p+1,n)):skip(p+1,n)}}r=r.concat(o),i=i.concat(s)}return[r,i]}}function renderParagraph(k){return function(f,h){function r(t,e){for(var i=0,n=0,r=null;null!==(r=h(n));){if(e-i<r.height)return[r,n];i+=Math.floor(r.height/t)*t,n++}return[null,n]}var p,d,i,t,y=[],a=0,n=null,e=[];switch(k.align){case"left":default:t=left;break;case"center":t=center;break;case"justify":t=justify}for(var l=t(f.measure,k.hypher,k.spans,null),o=linebreak(l.map(function(t){return t.value}),memoize(function(t){var e=r(k.leading,a+(t+1)*k.leading),i=e[0],n=(e[1],(k.leftIndentation?k.leftIndentation(t):0)+(k.rightIndentation?k.rightIndentation(t):0));return null!==i?i.width-n:null}),{tolerance:k.tolerance||10}),s=[],u=0,g=1;g<o.length;g+=1){for(var c=o[g].position,v=o[g].ratio,x=u;x<l.length;x+=1)if("box"===l[x].value.type||"penalty"===l[x].value.type&&l[x].value.penalty===-linebreak.infinity){u=x;break}s.push({ratio:v,nodes:l.slice(u,c+1),position:c}),u=c}p=0,s.forEach(function(l,t){var e,o=0,s=0,u=k.leftIndentation?k.leftIndentation(t):0;p+=k.leading,a+=k.leading,e=r(k.leading,a),d=e[0],i=e[1],null===n||bboxEq(d,n)||(p=k.leading),n=d,l.nodes.forEach(function(t,e,i){var n=-f.fontMetrics(t.style.fontFamily).ascender/1e3*t.style.fontSize,r=d.x+o,h=d.y+p;if("box"===t.value.type){if(0===o){var a=t.value.value[0]?f.glyphMetrics(t.style.fontFamily,t.value.value[0]).leftBearing:0;s=-a/1e3*t.style.fontSize}y.push({type:"text",x:r+s+u,y:h+n,span:t.style,text:t.value.value}),o+=t.value.width}else"glue"===t.value.type?o+=t.value.width+l.ratio*(l.ratio<0?t.value.shrink:t.value.stretch):"penalty"===t.value.type&&100===t.value.penalty&&e===i.length-1&&y.push({type:"text",x:r+s+u,y:h+n,span:t.style,text:"-"})})});for(var w=0;w<i;w++)e.push(h(w));return null!=d&&e.push({x:d.x,y:d.y,width:d.width,height:Math.min(d.height,p+(k.paragraphLeading||0))}),[e,y]}}function renderText(t){return vertically(t.map(function(t){return renderParagraph(t)}))}function renderColumns(t,e){for(var i=[],n=0,r=0,h=e;r<h.length;r++){var a=h[r],l=a[0],o=a[1];i.push([[n,l],o]),n+=l+t}return combine(i.map(function(t){var e,i,n,r=t[0],h=t[1];return[(e=r,i=e[0],n=e[1],function(t){return{x:t.x+i,y:t.y,width:n,height:t.height}}),h]}))}function renderTable(e,i,t){return vertically(t.map(function(t){return renderColumns(e,zip(i,t))}))}function renderPolygon(r,h){return function(t,e){var i=e(0),n=bboxForPoints(r);return[[{x:i.x+n.x,y:i.y+n.x,width:n.width,height:n.height}],[{type:"polygon",x:i.x,y:i.y,points:r.map(function(t){return{x:t.x+i.x,y:t.y+i.y}}),style:h}]]}}function pdfKitDocMeasures(n){return{measure:function(t,e,i){return n.font(t)._font.widthOfString(i,e)},fontMetrics:function(t){return{ascender:n.font(t)._font.ascender}},glyphMetrics:function(t,e){return{leftBearing:n.font(t)._font.font.layout(e).glyphs[0]._metrics.leftBearing}}}}function jsPdfDocMeasures(r){return{measure:function(t,e,i){var n=String(t).split("\t");return r.setFont(n[0],n[1]).getStringUnitWidth(i)*e},fontMetrics:function(t){return{ascender:0}},glyphMetrics:function(t,e){return{leftBearing:0}}}}function setStyle(t,e){void 0!==e.lineWidth&&t.lineWidth(e.lineWidth),void 0!==e.strokeColor&&t.strokeColor(e.strokeColor),void 0!==e.fillColor&&t.fillColor(e.fillColor),void 0!==e.strokeOpacity&&t.strokeOpacity(e.fillColor),void 0!==e.fillOpacity&&t.fillOpacity(e.fillColor),void 0!==e.lineJoin&&t.lineJoin(e.lineJoin),void 0!==e.lineCap&&t.lineCap(e.lineCap)}function renderToPages(t,e,i,n){for(var r=0,h=0,a=i;h<a.length;h++)for(var l=0,o=a[h];l<o.length;l++){var s=o[l],u=Math.floor(s.y/e.height);r=Math.max(r,u)}var f=Array(r+1).fill([]);if(n)for(u=0;u<=r;u++)for(var p=0,d=n(u);p<d.length;p++)for(var y=0,g=d[p];y<g.length;y++){s=g[y];f[u].push(s)}for(var c=0,v=i;c<v.length;c++)for(var x=0,w=v[c];x<w.length;x++){s=w[x];f[u=Math.floor(s.y/e.height)].push(s)}for(u=0;u<=r;u++){0!=u&&t.addPage();for(var k=0,b=f[u];k<b.length;k++){s=b[k];switch(t.save(),s.type){case"text":t.save(),setStyle(t,s.span.style||{}),t.font(s.span.fontFamily).fontSize(s.span.fontSize)._fragment(s.text,s.x,s.y-u*e.height,s.span.options||{}),t.restore();break;case"polygon":t.save(),setStyle(t,s.style||{}),s.style.fillColor&&s.style.strokeColor?(t.polygon.apply(t,s.points.map(function(t){return[t.x,t.y]})),t.fillAndStroke()):s.style.fillColor?(t.polygon.apply(t,s.points.map(function(t){return[t.x,t.y]})),t.fill()):s.style.strokeColor&&(t.polygon.apply(t,s.points.map(function(t){return[t.x,t.y]})),t.stroke()),t.restore()}}}}function renderToPDF(t,e,i,n,r,h){var a=new r({layout:"portrait",size:[e.width,e.height]}),l=pdfKitDocMeasures(a),o=h.createWriteStream(t);a.pipe(o);var s=void 0;return n&&(s=function(t){return n(t).map(function(t){return t.renderer(l,t.bboxes)[1]})}),renderToPages(a,e,i.map(function(t){return t.renderer(l,t.bboxes)[1]}),s),a.end(),o}function withMargins(e,i,n,r,h){return function(t){return{tag:"new_page",x:h,y:t*e.height+i,width:e.width-(h+n),height:e.height-(i+r)}}}function columnsWithMargins(e,i,n,r,h,a){return function(t){return t%2==0?{tag:"new_page",x:a,y:Math.floor(t/2)*e.height+n,width:e.width/2-i/2-a,height:e.height-(n+h)}:{x:i/2+e.width/2,y:Math.floor(t/2)*e.height+n,width:e.width/2-i/2-r,height:e.height-(n+h)}}}var pageBreak=function(t,e){for(var i=0,n=[];"new_page"!==e(i).tag;)n.push(e(i)),i++;return[n,[]]};exports.columnsWithMargins=columnsWithMargins,exports.combine=combine,exports.formats=formats,exports.idRenderer=idRenderer,exports.jsPdfDocMeasures=jsPdfDocMeasures,exports.landscape=landscape,exports.pageBreak=pageBreak,exports.pdfKitDocMeasures=pdfKitDocMeasures,exports.renderColumns=renderColumns,exports.renderParagraph=renderParagraph,exports.renderPolygon=renderPolygon,exports.renderTable=renderTable,exports.renderText=renderText,exports.renderToPDF=renderToPDF,exports.renderToPages=renderToPages,exports.vertically=vertically,exports.withMargins=withMargins;
